<%# app/views/dashboard/pdf.html.erb %>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Relatório Executivo - Dashboard</title>

    <style>
      body {
        font-family: "Arial", sans-serif;
        color: #222;
      }
      .header {
        text-align: center;
        margin-bottom: 32px;
      }
      .header h1 {
        font-size: 2.5em;
        color: #b91c1c;
        margin-bottom: 0.2em;
      }
      .header p {
        color: #555;
        font-size: 1.1em;
      }
      .metrics {
        display: flex;
        justify-content: center;
        gap: 32px;
        margin-bottom: 32px;
      }
      .metric-card {
        border-radius: 16px;
        box-shadow: 0 2px 8px #0001;
        padding: 24px 32px;
        min-width: 180px;
        text-align: center;
      }
      .metric-card .icon {
        font-size: 2.2em;
        margin-bottom: 0.2em;
      }
      .metric-card .value {
        font-size: 2em;
        font-weight: bold;
        color: #b91c1c;
      }
      .metric-card .label {
        color: #666;
        font-size: 1em;
        margin-top: 0.2em;
      }
      .section {
        margin-bottom: 32px;
      }
      .section h2 {
        color: #b91c1c;
        font-size: 1.3em;
        margin-bottom: 0.7em;
        border-bottom: 1px solid #eee;
        padding-bottom: 0.2em;
      }
      .sentiment {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 8px;
      }
      .sentiment span {
        border-radius: 8px;
        padding: 6px 14px;
        font-size: 1em;
        font-weight: 600;
      }
      .sentiment .positive {
        background: #dcfce7;
        color: #166534;
      }
      .sentiment .negative {
        background: #fee2e2;
        color: #991b1b;
      }
      .sentiment .neutral {
        background: #f3f4f6;
        color: #374151;
      }
      .summary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
      }
      .summary-table th,
      .summary-table td {
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        text-align: center;
      }
      .summary-table th {
        background: #f1f5f9;
        color: #b91c1c;
      }
      .summary-table td {
        background: #fff;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        min-height: 100vh;
        position: relative;
        box-sizing: border-box;
        padding-bottom: 46px;
      }
      .footer {
        position: fixed;
        left: 0;
        bottom: 0px;
        width: 100%;
        text-align: center;
        color: #888;
        font-size: 0.95em;
        padding: 12px 0 8px 0;
        background: #fff;
        box-shadow: 0 -2px 8px #0001;
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      <div class="header">
        <h1>Relatório Executivo</h1>
        <p>Visão geral dos principais indicadores da empresa</p>
      </div>

      <table class="summary-table" style="margin-bottom: 32px">
        <thead>
          <tr>
            <th></th>
            <th>Colaboradores</th>
            <th>Feedback médio</th>
            <th>eNPS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Métricas</strong></td>
            <td><%= @report[:headcount] %></td>
            <td><%= format_percent(@report[:avg_feedback] / 10.0) %></td>
            <td><%= @report[:enps] %></td>
          </tr>
        </tbody>
      </table>

      <div class="section">
        <h2>Sentimento dos Comentários</h2>
        <div class="sentiment">
          <span class="positive"
            >Positivo: <%= @report[:sentiment][:positive] %>%</span
          >
          <span class="negative"
            >Negativo: <%= @report[:sentiment][:negative] %>%</span
          >
          <span class="neutral"
            >Neutro: <%= @report[:sentiment][:neutral] %>%</span
          >
        </div>
      </div>

      <% if @eda && @eda[:summary_stats].present? %>
      <div class="section">
        <h2>Estatísticas Descritivas dos Feedbacks</h2>
        <table class="summary-table">
          <thead>
            <tr>
              <% @eda[:summary_stats].each_key do |stat| %>
              <th><%= stat %></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <tr>
              <% @eda[:summary_stats].each_value do |value| %>
              <td><%= value %></td>
              <% end %>
            </tr>
          </tbody>
        </table>
      </div>
      <% end %>

      <div class="section">
        <h2>Distribuição do Tempo de Empresa</h2>
        <% if @eda && @eda[:tenure_distribution].present? %>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Tempo de Empresa</th>
              <th>Quantidade</th>
            </tr>
          </thead>
          <tbody>
            <% @eda[:tenure_distribution].each do |faixa, qtd| %>
            <tr>
              <td><%= faixa %></td>
              <td><%= qtd %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
        <% else %>
        <div class="text-gray-400 text-lg mt-4 mb-4">Sem dados disponíveis</div>
        <% end %>
      </div>

      <div class="section">
        <h2>Boxplot de Feedback Geral</h2>
        <% if @eda && @eda[:feedback_boxplot].present? %>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Mínimo</th>
              <th>Q1</th>
              <th>Mediana</th>
              <th>Q3</th>
              <th>Máximo</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <% @eda[:feedback_boxplot].each do |v| %>
              <td><%= v %></td>
              <% end %>
            </tr>
          </tbody>
        </table>
        <% else %>
        <div class="text-gray-400 text-lg mt-4 mb-4">Sem dados disponíveis</div>
        <% end %>
      </div>

      <div class="section">
        <h2>Funcionários por Área</h2>
        <% area_data = EmployeeMetricsQuery.new.employees_per_area %> <% if
        area_data.present? %>
        <table class="summary-table">
          <thead>
            <tr>
              <th>Área</th>
              <th>Quantidade</th>
            </tr>
          </thead>
          <tbody>
            <% area_data.each do |area, qtd| %>
            <tr>
              <td><%= area.presence || 'Não informado' %></td>
              <td><%= qtd %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
        <% else %>
        <div class="text-gray-400 text-lg mt-4 mb-4">Sem dados disponíveis</div>
        <% end %>
      </div>
    </div>

    <div class="footer">
      Relatório gerado em <%= I18n.l(Time.zone.now, format: :long) %> &mdash;
      Powered by Pin People Challenge
    </div>
  </body>
</html>
